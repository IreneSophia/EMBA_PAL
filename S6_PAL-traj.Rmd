---
title: "S4: exploration of the rt and rt.var trajectories"
author: "I. S. Plank"
date: "`r Sys.Date()`"
output: html_document
---
  
```{r settings, include=FALSE}

knitr::opts_chunk$set(echo = T, warning = F, message = F, fig.align = 'center', fig.width = 9)
ls.packages = c("knitr",# kable
    "ggplot2",          # plots
    "tidyverse",        # tibble stuff
    "ggpubr",           # ggarrange
    "ggrain",           # geom_rain
    "BayesFactor"
)

lapply(ls.packages, library, character.only=TRUE)

# set cores
options(mc.cores = parallel::detectCores())

# set options for SBC
use_cmdstanr = getOption("SBC.vignettes_cmdstanr", TRUE) # Set to false to use rstan instead
options(brms.backend = "cmdstanr")

# using parallel processing
library(future)
plan(multisession)

# graph settings 
sz = 1
a = 0.5

# custom colour palette
custom.col4 = c("#FFC107", "#004D40", "#1E88E5", "#D81B60")
custom.col2 = c("#5D3A9B", "#E66100")

```

<style type="text/css">
  .main-container {
    max-width: 1100px;
    margin-left: auto;
    margin-right: auto;
  }
</style>
  
# S4.1 Introduction
  
This R Markdown script analyses data from the PAL (probabilistic associative learning) task of the EMBA project. HGF parameters were extrated based on the subject-specific reaction times beforehand in MATLAB. 

## Package versions

The following packages are used in this RMarkdown file: 
  
```{r lib_versions, echo=F}

print(R.Version()$version.string)

for (package in ls.packages) {
  print(sprintf("%s version %s", package, packageVersion(package)))
}

```

## Preparation

First, we load the parameters from the winning model.

```{r prep, fig.height=4}

# load the data [!MISSING]

```

# Reaction times

```{r rt_cont, fig.height=6}

df %>%
  group_by(diagnosis, trl) %>%
  summarise(
    rt.std = sd(rt.cor, na.rm = T),
    rt.cor = mean(rt.cor, na.rm = T)
  ) %>%
  ggplot(., aes(colour = diagnosis, group = diagnosis)) +
  geom_ribbon(aes(ymin = rt.cor - rt.std, ymax = rt.cor + rt.std), 
              alpha = 0.5) + 
  geom_line(aes(x = trl, y = rt.cor)) +
  geom_vline(xintercept = c(72, 264), colour = "black") + 
  labs(title = "RTs across task", x = "trials", y = "") +
  scale_fill_manual(values  = custom.col4) +
  scale_color_manual(values = custom.col4) +
  theme_bw() + 
  theme(legend.position = "bottom", plot.title = element_text(hjust = 0.5), 
        legend.direction = "horizontal", text = element_text(size = 15))

```


# Reaction time variance

```{r rt_cont, fig.height=6}

df %>%
  mutate(
    trl = if_else(trl%%8 == 0,trl/8,NA)
  ) %>%
  fill(trl, .direction = "up") %>%
  group_by(subID, trl) %>%
  summarise(
    rt.var = var(rt.cor, na.rm = T)
  ) %>%
  group_by(diagnosis, trl) %>%
  summarise(
    rt.std = sd(rt.var, na.rm = T),
    rt.var = mean(rt.var, na.rm = T)
  )
  ggplot(., aes(x = trl, colour = diagnosis, group = diagnosis)) +
  geom_ribbon(aes(ymin = rt.var - rt.std, ymax = rt.var + rt.std), 
              alpha = 0.5) + 
  geom_line(aes(y = rt.var)) +
  geom_vline(xintercept = c(72, 264), colour = "black") + 
  labs(title = "RT vars across task", x = "block of 8 trials", y = "") +
  scale_fill_manual(values  = custom.col4) +
  scale_color_manual(values = custom.col4) +
  theme_bw() + 
  theme(legend.position = "bottom", plot.title = element_text(hjust = 0.5), 
        legend.direction = "horizontal", text = element_text(size = 15))

```
